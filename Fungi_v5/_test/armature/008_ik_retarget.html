<!DOCTYPE html><script type="module">
import App			from "../../fungi/App.js";
import VecBuffer	from "../../fungi/data/VecBuffer.js";
import Transform	from "../../fungi/maths/Transform.js";
import { Chain }	from "../../fungi.armature/IKRig.js";
import IKTarget 	from "../../fungi.armature/IKTarget.js";

import XhrPromise	from "../../fungi/lib/XhrPromise.js";
import GltfUtil		from "../../fungi/lib/GltfUtil.js";
import IKRig		from "../../fungi.armature/IKRig.js";

//#####################################################

App.builder( true )
	.use_armature()
	.load_shaders( "../fungi.armature/LowPolySkin.js" )
	.set_camera( 0, 0, 3.5, 0, 0.7, 0 )
	.add( init )
	//.render_loop()
	.render_on_mouse()
	.build();

//#####################################################

async function init(){
	
	//raw_bone_test();
	await mesh_test();

	return true;
}

//#####################################################

async function mesh_test_v(){	
	let dl = await XhrPromise.get( 
		"../../files/models/vegeta.gltf", "json", 
		"../../files/models/vegeta.bin", "arraybuffer",
	);

	let mat		= App.new_mat( "LowPolySkin", {color:"#ffffff"} );
	let e		= GltfUtil.get_debug_view( "entity", dl[0], dl[1], mat );
	//let e		= GltfUtil.get_bone_view( "entity", dl[0], dl[1] );
	let tpose	= GltfUtil.get_pose( e, dl[0], "tpose", true );
	let rig 	= e.add_com( "IKRig" ).init( tpose, false );
	tpose.apply();
}

async function mesh_test(){	
	let dl = await XhrPromise.get( 
		"../../_tmp/robo_trex.gltf", "json", 
		"../../_tmp/robo_trex.bin", "arraybuffer",
	);

	let mat		= App.new_mat( "LowPolySkin", {color:"#ffffff"} );
	let e		= GltfUtil.get_debug_view( "entity", dl[0], dl[1], mat );
	//let e		= GltfUtil.get_bone_view( "entity", dl[0], dl[1] );
	//let tpose	= GltfUtil.get_pose( e, dl[0], "tpose", true );
	//let rig 	= e.add_com( "IKRig" ).init( tpose, false );
	//tpose.apply();
}

</script><page-layout></page-layout>