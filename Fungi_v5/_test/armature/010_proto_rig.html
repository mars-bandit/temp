<!DOCTYPE html><script type="module">
import App, { Quat, Vec3 }				from "../../fungi/App.js";
import InterleavedFloatArray from "../../fungi/data/InterleavedFloatArray.js";
import Capsule from "../../fungi/geo/Capsule.js";

//#####################################################

App.builder( false, true )
	.use_armature()
	.set_camera( 0, 25, 2, 0, 0.0, 0 )
	.add( init )
	//.render_loop( on_draw )
	.render_on_mouse()
	.build();

//#####################################################
let E;

function on_draw( dt, ss ){
	let b = E.Armature.get_e( "Bone1" );
	//console.log( b );
	//e.Node.set_rot_axis( App.Vec3.LEFT, 10 );
	b.Node.rot_by( 45 * dt, "x" );
	E.Armature.updated = true;
}

async function init(){
	load_shader();
	ProtoRig.init();

    let e = ProtoRig.$( "rig", PROTO_MAN, false );
    //console.log( e );

	//let b = e.Armature.get_e( "Bone1" );
	//console.log( b );
	//e.Node.set_rot_axis( App.Vec3.LEFT, 10 );
	//b.Node.rot_by( 45, "x" );

	//E = e;
	return true;
}

const TEST = [
	{ "name":"Bone0", "len":0.07, "idx":0, "p_idx":null, "bone_pos":[0,0.125,0], "bone_rot":[0,0,0,1], "top":[0.12,0.12,0.12,0.05], "bot":[0.12,0.12,0.12,-0.05], "rot":[0,0,0,1] },
	{ "name":"Bone1", "len":0.07, "idx":1, "p_idx":0, "bone_pos":[0,.25,0], "bone_rot":[0,0,0,1], "top":[0.12,0.12,0.12,0.05], "bot":[0.12,0.12,0.12,-0.05], "rot":[0,0,0,1] },
];

//#####################################################

function ProtoRigSys( ecs ){
	let ary = ecs.query_comp( "ProtoRig" );
	if( !ary ) return; // No Componets, skip.

	let i, a, e, ws, bones, flat;
	for( a of ary ){
		e = ecs.entities[ a.entity_id ];		
		if( !e.Armature.updated ) continue;

		bones	= e.Armature.bones;
		flat	= e.ProtoRig.bone_transform;
				
		for( i=0; i < bones.length; i++ ){
			ws = bones[ i ].ref.Node.world;
			flat.set( i, ws.rot, ws.pos );
		}

		e.ProtoRig.update_bone_buffer();
	}
}

class ProtoRig{
	static init( priority = 810 ){
		App.Components.reg( ProtoRig );
		App.ecs.sys_add( ProtoRigSys, priority );
	}

    static $( name, config, use_preview=false ){
		let e = App.$( name, ["Node","Draw","ProtoRig", "Armature"] );
		let p = e.ProtoRig;
        
		p.build( e, config );
		
		if( use_preview ) e.add_com( "BoneView" ).init();
		return e;
	}

	constructor(){
		this.bone_buffer = null;

		// Flat Worldspace Transfrom from Armature Bones
	    this.bone_transform = new InterleavedFloatArray()
	    	.add_var( "rot", 4 )
	    	.add_var( "pos", 3 );

	    // Capsule Visual Configuration
	    this.config = new InterleavedFloatArray()
	    	.add_var( "top", 4 )	// xyz = scale dome, w translate Y position
	    	.add_var( "bot", 4 )
	    	.add_var( "rot", 4 );	// Quaternion Rotation
	}

	build( e, ary ){
        let cnt = ary.length,
            arm = e.Armature,
            bt  = this.bone_transform,
            cfg = this.config;

        bt.expand_by( cnt, true );      // Initialize Bone Transform Buffer, Auto fill with 0s
        cfg.expand_by( cnt, false );    // Initialize Capsule Config Buffer, Fill in Manually

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Build up armature bones and capsule configurations
        let itm;    
        for( itm of ary ){
			// Create Bone Entity
			console.log( itm.name );
            arm.add_bone( itm.name, itm.len, itm.p_idx )
            	.Node
				.set_rot( itm.bone_rot )
				.set_pos( itm.bone_pos );

            // Save Visual Config
            cfg.push( itm.top, itm.bot, itm.rot );
		}
		
		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Setup Buffer to hold the Flat World Space Transform of the Bones
		this.bone_buffer = App.Buf.new_array( bt.buffer, 0, false );
		this.bone_buffer.set_interleaved( bt.get_stride_info() );

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Build Capsule Mesh
		// (arc_div-1) * lathe_cnt + 1 == Dome Vert Count
		let geo 	= Capsule.geo( 10, 4, 0.5, 0 ), //Capsule.geo( lathe_cnt=8, arc_div=5, radius=0.5, height=0.25 )
			mesh	= new App.Mesh( "Proto" ),
			vao 	= new App.Vao().bind();

		mesh.buf.idx = App.Buf.new_element( geo.ind, true, false );
		vao.add_indices( mesh.buf.idx );

		mesh.buf.vert = App.Buf.new_array( geo.vert, 3, true, false );
		vao.add_buf( mesh.buf.vert, App.Shader.POS_LOC );
		
		mesh.buf.norm = App.Buf.new_array( geo.norm, 3, true, false );
		vao.add_buf( mesh.buf.norm, App.Shader.NORM_LOC );

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Instanced Data 
		
		// Capsule Configuration
		mesh.buf.cfg = App.Buf
			.new_array( cfg.buffer )
			.set_interleaved( cfg.get_stride_info() );
		vao.add_interleaved( mesh.buf.cfg, [13,14,15], true );

		// Bone Transform ( Instanced )
		vao.add_interleaved( this.bone_buffer, [10,11], true );

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Clean up VAO Building and Get Mesh Ready
		App.Vao.unbind();
		App.Buf.unbind_array().unbind_element();

		mesh.set( vao, geo.ind.length, cfg.len );	// Set VAO and Count Values to render mesh
		arm.finalize();								// Compile Bind Pose

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		let mat = SHADER.new_material( "ProtoRigMat" );
		e.Draw.add( mesh, mat, App.Mesh.TRI );
	}

	update_bone_buffer(){ 
		this.bone_buffer.update( this.bone_transform.buffer );
	}

}


//##############################################################

let SHADER = null;
function load_shader(){
	SHADER = App.Shader.from_src( "ProtoRig", vert_src, frag_src )
		.add_uniform_blocks( ["Global","Model"] );
		//.add_uniform( "cube_tex", "samplerCube", null );
}

const vert_src = `#version 300 es
	layout(location=0) in vec3 a_pos;
	layout(location=1) in vec3 a_norm;
	layout(location=2) in vec2 a_uv;

	layout(location=10)	in vec4 a_ins_rot;
	layout(location=11)	in vec3 a_ins_pos;

	layout(location=13)	in vec4 a_cfg_top;
	layout(location=14)	in vec4 a_cfg_bot;
	layout(location=15)	in vec4 a_cfg_rot;

	uniform Global{ 
		mat4 proj_view; 
		mat4 camera_matrix;
		vec3 camera_pos;
		float delta_time;
		vec2 screen_size;
		float clock;
	} global;

	uniform Model{ 
		mat4 view_matrix;
	} model;

	//out vec2 frag_uv;
	out vec3 frag_norm;
	out vec3 frag_cam_pos;
	out vec3 frag_pos;

	const int DIV_IDX = 31; // LT = TOP DOME
	vec3 quat_mul_vec3( vec4 q, vec3 v ){ return v + (2.0 * cross(q.xyz, cross(q.xyz, v) + (q.w * v))); }

	vec4 qmul(vec4 q1, vec4 q2){
		return vec4(q2.xyz * q1.w + q1.xyz * q2.w + cross(q1.xyz, q2.xyz), q1.w * q2.w - dot(q1.xyz, q2.xyz) );
	}

	void main(void){
		vec3 pos	= a_pos;

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Capsule Configuration
		if( gl_VertexID < DIV_IDX ){
			pos.xyz	*= a_cfg_top.xyz;	// Scale Dom
			pos.y	+= a_cfg_top.w;		// Move Dome
		}else{
			pos.xyz	*= a_cfg_bot.xyz;	// Scale Dom
			pos.y	+= a_cfg_bot.w;		// Move Dome
		}

		pos = quat_mul_vec3( a_cfg_rot, pos );
		

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// Transform Instances
		pos 		= quat_mul_vec3( a_ins_rot, pos );
		pos 		+= a_ins_pos;

		vec4 wpos = model.view_matrix * vec4( pos, 1.0 );

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		//frag_uv		= a_uv;
		frag_pos		= wpos.xyz;

		frag_norm 		= quat_mul_vec3( qmul( a_cfg_rot, a_ins_rot ), a_norm );
		frag_norm 		= mat3( transpose( inverse( model.view_matrix ) ) ) * frag_norm;
		
		//frag_cam_pos	= global.camera_pos;
		

		//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		gl_Position = global.proj_view * wpos;
		gl_PointSize = 5.0;

	}`;

const frag_src = `#version 300 es
	precision mediump float;
	
	out vec4 out_color;

	//-------------------------

	in vec3 frag_norm;
	//in vec3 frag_cam_pos;
	in vec3 frag_pos;

	const vec3 color 				= vec3( 1.0, 0.0, 0.0 );
	const vec3 lightPosition 		= vec3( 6.0, 10.0, 1.0 );
	const vec3 lightColor 			= vec3( 1.0, 1.0, 1.0 );
	const float uAmbientStrength	= 0.5;
	const float uDiffuseStrength	= 0.5;

	//-------------------------

	void main( void ){
		//out_color = vec4( 1.0, 0.0, 0.0, 1.0 );
		//vec3 frag_norm = normalize( cross( dFdx(frag_pos), dFdy(frag_pos) ) ); //Calc the Normal of the Rasterizing Pixel

		// Ambient Lighting
		vec3 cAmbient		= lightColor * uAmbientStrength;

		// Diffuse Lighting
		vec3 lightVector	= normalize( lightPosition - frag_pos );		//light direction based on pixel world position
		float diffuseAngle	= max( dot( frag_norm, lightVector ) ,0.0 );	//Angle between Light Direction and Pixel Direction (1==90d)
		vec3 cDiffuse		= lightColor * diffuseAngle * uDiffuseStrength;

		out_color = vec4( color * ( cAmbient + cDiffuse ), 1.0 );
	}
`;



const QUAT_Z90	= Array.from( new Quat().from_axis_angle( [0,0,1], 90 * Math.PI / 180 ) );
const QUAT_Z180	= Array.from( new Quat().from_axis_angle( [0,0,1], Math.PI ) );
const QUAT_X180	= Array.from( new Quat().from_axis_angle( [1,0,0], Math.PI ) );

const QUAT_ZN90	= Array.from( new Quat().from_axis_angle( [0,0,1], -90 * Math.PI / 180 ) );
const QUAT_X90	= Array.from( new Quat().from_axis_angle( [1,0,0], 90 * Math.PI / 180 ) );
const QUAT_XN90	= Array.from( new Quat().from_axis_angle( [1,0,0], -90 * Math.PI / 180 ) );
const QUAT_X45	= Array.from( new Quat().from_axis_angle( [1,0,0], 45 * Math.PI / 180 ) );
const QUAT_XN45	= Array.from( new Quat().from_axis_angle( [1,0,0], -45 * Math.PI / 180 ) );
const QUAT_XN20	= Array.from( new Quat().from_axis_angle( [1,0,0], -20 * Math.PI / 180 ) );
const QUAT_XN10	= Array.from( new Quat().from_axis_angle( [1,0,0], -10 * Math.PI / 180 ) );
const QUAT_X10	= Array.from( new Quat().from_axis_angle( [1,0,0], 10 * Math.PI / 180 ) );
const QUAT_X20	= Array.from( new Quat().from_axis_angle( [1,0,0], 20 * Math.PI / 180 ) );
const QUAT_NONE	= [0,0,0,1];

const PROTO_MAN = [
	{ "name":"Hips", "len":0.07, "idx":0, "p_idx":null,		"bone_pos":[0,0.750,0],		"bone_rot":[0,0,0,1], "top":[0.12,0.12,0.12,0.05], "bot":[0.12,0.12,0.12,-0.05], "rot":QUAT_Z90 },
	{ "name":"Spine", "len":0.09, "idx":1, "p_idx":0,		"bone_pos":[0,0.07,0],	"bone_rot":[0,0,0,1], "top":[0.1,0.1,0.1,0.1], "bot":[0.1,0.1,0.1,0], "rot":QUAT_NONE },
	{ "name":"Spine1", "len":0.1, "idx":2, "p_idx":1,		"bone_pos":[0,0.09,0],	"bone_rot":[0,0,0,1], "top":[0.14,0.14,0.14,0.1], "bot":[0.13,0.13,0.13,0], "rot":QUAT_NONE },
	{ "name":"Spine2", "len":0.07, "idx":3, "p_idx":2,		"bone_pos":[0,0.1,0.0],	"bone_rot":[0,0,0,1], "top":[0.16,0.16,0.18,0.06], "bot":[0.16,0.16,0.18,-0.06], "rot":QUAT_Z90 },
	{ "name":"Neck", "len":0.07, "idx":4, "p_idx":3,		"bone_pos":[0,0.07,0],	"bone_rot":[0,0,0,1], "top":[0.06,0.06,0.06,0.05], "bot":[0.07,0.07,0.07,0], "rot":QUAT_NONE },
	{ "name":"Head", "len":0.1, "idx":5, "p_idx":4,			"bone_pos":[0,0.07,0.015],	"bone_rot":[0,0,0,1], "top":[0.12,0.11,0.12,0.045], "bot":[0.105,0.13,0.105,0], "rot":QUAT_NONE },

	{ "name":"LeftShoulder", "len":0.075, "idx":6, "p_idx":3,	"bone_pos":[0.09,0.03,-0.002],	"bone_rot":QUAT_ZN90, "top":[0.11,0.11,0.12,0.02], "bot":[0.11,0.11,0.12,0], "rot":QUAT_NONE },
	{ "name":"LeftArm", "len":0.19, "idx":7, "p_idx":6,	"bone_pos":[0,0.075,0],	"bone_rot":QUAT_NONE, "top":[0.060,0.060,0.060,0.15], "bot":[0.08,0.08,0.08,0], "rot":QUAT_NONE },
	{ "name":"LeftForeArm", "len":0.170, "idx":8, "p_idx":7,	"bone_pos":[0,0.19,0],	"bone_rot":QUAT_NONE, "top":[0.05,0.05,0.05,0.145], "bot":[0.07,0.07,0.07,0], "rot":QUAT_NONE },
	
	{ "name":"LeftHand", "len":0.020, "idx":9, "p_idx":8,	"bone_pos":[0,0.170,0],	"bone_rot":QUAT_NONE, "top":[0.05,0.05,0.06,0.0], "bot":[0.05,0.05,0.06,0], "rot":QUAT_NONE },
	{ "name":"LeftHandIndex1", "len":0.025, "idx":10, "p_idx":9,	"bone_pos":[-0.006,0.025,0.013],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
	{ "name":"LeftHandIndex2", "len":0.015, "idx":11, "p_idx":10,	"bone_pos":[0,0.025,0.0],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },

	{ "name":"LeftHandMiddle1", "len":0.025, "idx":12, "p_idx":9,	"bone_pos":[-0.006,0.025,-0.013],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
	{ "name":"LeftHandMiddle1", "len":0.015, "idx":13, "p_idx":12,	"bone_pos":[0,0.025,0.0],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },

	{ "name":"LeftHandThumb1", "len":0.02, "idx":14, "p_idx":9,	"bone_pos":[-0.006,0.005,0.03],	"bone_rot":QUAT_X90, "top":[0.02,0.02,0.02,0.004], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
	{ "name":"LeftHandThumb2", "len":0.010, "idx":15, "p_idx":14,	"bone_pos":[0,0.02,0.0],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.004], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },

	{ "name":"LeftUpLeg", "len":0.35, "idx":16, "p_idx":0,	"bone_pos":[ 0.075, -0.01, 0 ],	"bone_rot":QUAT_Z180, "top":[0.08,0.08,0.08,0.30], "bot":[0.10,0.1,0.10,0], "rot":QUAT_NONE },
	{ "name":"LeftUpLeg", "len":0.35, "idx":17, "p_idx":16,	"bone_pos":[ 0, 0.36, 0 ],	"bone_rot":QUAT_NONE, "top":[0.055,0.055,0.055,0.31], "bot":[0.08,0.08,0.08,0], "rot":QUAT_NONE },
	{ "name":"LeftFoot", "len":0.11, "idx":18, "p_idx":17,	"bone_pos":[ 0, 0.35, 0 ],	"bone_rot":QUAT_X90, "top":[0.09,0.06,0.06,0.07], "bot":[0.09,0.06,0.06,0], "rot":QUAT_NONE },
	{ "name":"LeftToeBase", "len":0.05, "idx":19, "p_idx":18,	"bone_pos":[ 0, 0.11, 0 ],	"bone_rot":QUAT_NONE, "top":[0.06,0.06,0.055,0.015], "bot":[0.06,0.06,0.055,-0.015], "rot":QUAT_Z90 },

	{ "name":"RightUpLeg", "len":0.35, "idx":20, "p_idx":0,	"bone_pos":[ -0.075, -0.01, 0 ],	"bone_rot":QUAT_Z180, "top":[0.08,0.08,0.08,0.30], "bot":[0.10,0.1,0.10,0], "rot":QUAT_NONE },
	{ "name":"RightUpLeg", "len":0.35, "idx":21, "p_idx":20,	"bone_pos":[ 0, 0.36, 0 ],	"bone_rot":QUAT_NONE, "top":[0.055,0.055,0.055,0.31], "bot":[0.08,0.08,0.08,0], "rot":QUAT_NONE },
	{ "name":"RightFoot", "len":0.11, "idx":22, "p_idx":21,	"bone_pos":[ 0, 0.35, 0 ],	"bone_rot":QUAT_X90, "top":[0.09,0.06,0.06,0.07], "bot":[0.09,0.06,0.06,0], "rot":QUAT_NONE },
	{ "name":"RightToeBase", "len":0.05, "idx":23, "p_idx":22,	"bone_pos":[ 0, 0.11, 0 ],	"bone_rot":QUAT_NONE, "top":[0.06,0.06,0.055,0.015], "bot":[0.06,0.06,0.055,-0.015], "rot":QUAT_Z90 },

	{ "name":"RightShoulder", "len":0.075, "idx":24, "p_idx":3,	"bone_pos":[-0.09,0.03,-0.002],	"bone_rot":QUAT_Z90, "top":[0.11,0.11,0.12,0.02], "bot":[0.11,0.11,0.12,0], "rot":QUAT_NONE },
	{ "name":"RightArm", "len":0.19, "idx":25, "p_idx":24,	"bone_pos":[0,0.075,0],	"bone_rot":QUAT_NONE, "top":[0.060,0.060,0.060,0.15], "bot":[0.08,0.08,0.08,0], "rot":QUAT_NONE },
	{ "name":"RightForeArm", "len":0.170, "idx":26, "p_idx":25,	"bone_pos":[0,0.19,0],	"bone_rot":QUAT_NONE, "top":[0.05,0.05,0.05,0.145], "bot":[0.07,0.07,0.07,0], "rot":QUAT_NONE },
	

	{ "name":"RightHand", "len":0.020, "idx":27, "p_idx":26,	"bone_pos":[0,0.170,0],	"bone_rot":QUAT_NONE, "top":[0.05,0.05,0.06,0.0], "bot":[0.05,0.05,0.06,0], "rot":QUAT_NONE },
	{ "name":"RightHandIndex1", "len":0.025, "idx":28, "p_idx":27,	"bone_pos":[-0.006,0.025,0.013],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
	{ "name":"RightHandIndex2", "len":0.015, "idx":29, "p_idx":28,	"bone_pos":[0,0.025,0.0],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },

	{ "name":"RightHandMiddle1", "len":0.025, "idx":30, "p_idx":27,	"bone_pos":[-0.006,0.025,-0.013],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
	{ "name":"RightHandMiddle1", "len":0.015, "idx":31, "p_idx":30,	"bone_pos":[0,0.025,0.0],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.011], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },

	{ "name":"RightHandThumb1", "len":0.02, "idx":32, "p_idx":27,	"bone_pos":[-0.006,0.005,0.03],	"bone_rot":QUAT_X90, "top":[0.02,0.02,0.02,0.004], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
	{ "name":"RightHandThumb2", "len":0.010, "idx":33, "p_idx":32,	"bone_pos":[0,0.02,0.0],	"bone_rot":QUAT_NONE, "top":[0.02,0.02,0.02,0.004], "bot":[0.022,0.022,0.022,0], "rot":QUAT_NONE },
];

const PROTO_DINO = [
	{ "name":"Hips", "len":0.15, "idx":0, "p_idx":null,	"bone_pos":[0,0.5,0],			"bone_rot":QUAT_X90, "top":[0.45,0.45,0.45,0.05], "bot":[0.45,0.45,0.45,-0.05], "rot":QUAT_NONE },
	{ "name":"Spine", "len":0.15, "idx":1, "p_idx":0,	"bone_pos":[0,0.15,-0.03],	"bone_rot":QUAT_XN10, "top":[0.33,0.33,0.33,0.1], "bot":[0.33,0.33,0.33,0], "rot":QUAT_NONE },
	{ "name":"Spine1", "len":0.2, "idx":2, "p_idx":1,	"bone_pos":[0,0.15,-0.03],	"bone_rot":QUAT_XN10, "top":[0.30,0.30,0.30,0.1], "bot":[0.30,0.30,0.30,0], "rot":QUAT_NONE },
	{ "name":"Neck", "len":0.2, "idx":3, "p_idx":2,		"bone_pos":[0,0.2,-0.04],	"bone_rot":QUAT_NONE, "top":[0.20,0.20,0.20,0.15], "bot":[0.20,0.20,0.20,0], "rot":QUAT_NONE },
	{ "name":"Head", "len":0.1, "idx":4, "p_idx":3,		"bone_pos":[0,0.2,0.00],	"bone_rot":QUAT_X20, "top":[0.31,0.31,0.31,0.25], "bot":[0.34,0.34,0.34,0.1], "rot":QUAT_NONE },

	{ "name":"LeftLeg1", "len":0.24, "idx":5, "p_idx":0, "bone_pos":[0.18,0,0],	"bone_rot":QUAT_X90, "top":[0.18,0.18,0.18,0.18], "bot":[0.22,0.22,0.22,0.05], "rot":QUAT_NONE },
	{ "name":"LeftLeg2", "len":0.21, "idx":6, "p_idx":5, "bone_pos":[0,0.24,0],	"bone_rot":QUAT_NONE, "top":[0.10,0.10,0.10,0.19], "bot":[0.15,0.15,0.15,0.05], "rot":QUAT_NONE },
	{ "name":"LeftLeg3", "len":0.19, "idx":7, "p_idx":6, "bone_pos":[0,0.21,0],	"bone_rot":QUAT_NONE, "top":[0.06,0.06,0.06,0.20], "bot":[0.08,0.08,0.08,0.05], "rot":QUAT_NONE },
	{ "name":"LeftFoot", "len":0.1, "idx":8, "p_idx":7, "bone_pos":[0,0.21,0],	"bone_rot":QUAT_XN90, "top":[0.13,0.08,0.08,0.1], "bot":[0.13,0.08,0.08,0.02], "rot":QUAT_NONE },

	{ "name":"LeftArm1", "len":0.22, "idx":9, "p_idx":2, "bone_pos":[0.07,0.08,0.1],	"bone_rot":QUAT_ZN90, "top":[0.06,0.06,0.06,0.18], "bot":[0.08,0.08,0.08,0.00], "rot":QUAT_NONE },
	{ "name":"LeftArm2", "len":0.24, "idx":10, "p_idx":9, "bone_pos":[0,0.22,0],	"bone_rot":QUAT_NONE, "top":[0.04,0.04,0.04,0.18], "bot":[0.05,0.05,0.05,0.00], "rot":QUAT_NONE },

	{ "name":"Tail1", "len":0.19, "idx":11, "p_idx":0,	"bone_pos":[0,-0.2,-0.05],	"bone_rot":QUAT_X180, "top":[0.25,0.15,0.25,0.12], "bot":[0.25,0.1,0.25,0], "rot":QUAT_NONE },
	{ "name":"Tail2", "len":0.22, "idx":12, "p_idx":11,	"bone_pos":[0,0.19,0],	"bone_rot":QUAT_NONE, "top":[0.18,0.15,0.18,0.15], "bot":[0.21,0.1,0.21,0], "rot":QUAT_NONE },
	{ "name":"Tail3", "len":0.22, "idx":13, "p_idx":12,	"bone_pos":[0,0.22,0],	"bone_rot":QUAT_NONE, "top":[0.12,0.1,0.12,0.15], "bot":[0.17,0.1,0.17,0], "rot":QUAT_NONE },
	{ "name":"Tail4", "len":0.22, "idx":14, "p_idx":13,	"bone_pos":[0,0.22,0],	"bone_rot":QUAT_NONE, "top":[0.07,0.1,0.07,0.15], "bot":[0.11,0.1,0.11,0], "rot":QUAT_NONE },
	{ "name":"Tail5", "len":0.22, "idx":15, "p_idx":14,	"bone_pos":[0,0.22,0],	"bone_rot":QUAT_NONE, "top":[0.03,0.1,0.03,0.15], "bot":[0.07,0.1,0.07,0], "rot":QUAT_NONE },

	{ "name":"RightLeg1", "len":0.24, "idx":16, "p_idx":0, "bone_pos":[-0.18,0,0],	"bone_rot":QUAT_X90, "top":[0.18,0.18,0.18,0.18], "bot":[0.22,0.22,0.22,0.05], "rot":QUAT_NONE },
	{ "name":"RightLeg2", "len":0.21, "idx":17, "p_idx":16, "bone_pos":[0,0.24,0],	"bone_rot":QUAT_NONE, "top":[0.10,0.10,0.10,0.19], "bot":[0.15,0.15,0.15,0.05], "rot":QUAT_NONE },
	{ "name":"RightLeg3", "len":0.19, "idx":18, "p_idx":17, "bone_pos":[0,0.21,0],	"bone_rot":QUAT_NONE, "top":[0.06,0.06,0.06,0.20], "bot":[0.08,0.08,0.08,0.05], "rot":QUAT_NONE },
	{ "name":"RightFoot", "len":0.1, "idx":19, "p_idx":18, "bone_pos":[0,0.21,0],	"bone_rot":QUAT_XN90, "top":[0.13,0.08,0.08,0.1], "bot":[0.13,0.08,0.08,0.02], "rot":QUAT_NONE },

	{ "name":"RightArm1", "len":0.22, "idx":20, "p_idx":2, "bone_pos":[-0.07,0.08,0.1],	"bone_rot":QUAT_Z90, "top":[0.06,0.06,0.06,0.18], "bot":[0.08,0.08,0.08,0.00], "rot":QUAT_NONE },
	{ "name":"RightArm2", "len":0.24, "idx":21, "p_idx":20, "bone_pos":[0,0.22,0],	"bone_rot":QUAT_NONE, "top":[0.04,0.04,0.04,0.18], "bot":[0.05,0.05,0.05,0.00], "rot":QUAT_NONE },
];



//#####################################################
</script><page-layout></page-layout>